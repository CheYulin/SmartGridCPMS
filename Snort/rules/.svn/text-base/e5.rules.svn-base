include $BH_PATH/e5.synth.rules

alert icmp $HOME_NET any  -> $EXTERNAL_NET any       (msg:"E5[rb] ET WORM Allaple ICMP Sweep Ping Inbound"; icode:0; itype:8; content:"Babcdefghijklmnopqrstuvwabcdefghi"; threshold: type both, count 1, seconds 60, track by_src; classtype:trojan-activity; reference:url,www.sophos.com/virusinfo/analyses/w32allapleb.html; reference:url,isc.sans.org/diary.html?storyid=2451; sid:2003294; rev:5;)

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"E5[rb] BLEEDING-EDGE Virus Santy.B worm variants searching for targets (1)"; flow: to_server,established; content:"GET"; nocase; offset: 0; depth: 3; content:"/search|3f|q=inurl|3a2a|.php|3f2a|="; nocase; pcre:"/\d+&start=\d+/iR"; classtype: trojan-activity; reference:url,securityresponse.symantec.com/avcenter/venc/data/perl.santy.b.html; sid:2001617; rev:9; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"E5[rb] BLEEDING-EDGE Virus Santy.B worm variants searching for targets (2)"; flow: to_server,established; content:"GET"; nocase; offset: 0; depth: 3; content:"/search|3f|"; nocase; content:"q=inurl|3a|"; nocase; content:".php|3f|"; nocase; within: 10; pcre:"/&start=\d+/i"; classtype: trojan-activity; reference:url,securityresponse.symantec.com/avcenter/venc/data/perl.santy.b.html; sid:2001618; rev:8; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"E5[rb] BLEEDING-EDGE Virus Santy.B worm variants searching for targets (yahoo)"; flow: to_server,established; content:"GET"; nocase; offset: 0; depth: 3; content:"/search|3f|"; nocase; content:"p=inurl|3a|"; nocase; content:".php|3f2a|="; nocase; within: 10; content:"&ei=UTF-8&fl=0&all=1&pstart=1&b="; nocase; pcre:"/\d+/iR"; pcre:"/\d+/iR"; classtype: trojan-activity; reference:url,securityresponse.symantec.com/avcenter/venc/data/perl.santy.b.html; sid:2001619; rev:8; )
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"E5[rb] BLEEDING-EDGE VIRUS PHPInclude.Worm Outbound Attack --LOCAL INFECTION--"; flow: to_server,established; content:"?&cmd=cd%20/tmp\;wget%20"; nocase; content:"perl%20"; nocase; reference:url,www.k-otik.com/exploits/20041225.PhpIncludeWorm.php; classtype: trojan-activity; sid:2001615; rev:12; )

alert tcp $HOME_NET any -> $EXTERNAL_NET 5002:5003   (msg:"E5[rb] BLEEDING-EDGE WORM Potential MySQL bot connecting to IRC server"; flags: S,12; reference:url,isc.sans.org/diary.php?date=2005-01-27; classtype: trojan-activity; sid:2001690; rev:4; )
alert tcp $HOME_NET any -> $EXTERNAL_NET 6891:6900   (msg:"E5[rb] ET WORM Bropia.F Worm Propagation"; flow: established,to_server; content:"|E1 37 A2 BA 6E 5C 63 8B D6 D1 F7 3C BA 13 16 FD 77 21 5A 5C 17 1B 29 4A 4F 15 A9 29 CF FA 48 3A|"; reference:url,www.trendmicro.com/vinfo/virusencyclo/default5.asp?VName=WORM%5FBROPIA%2EF; classtype: misc-attack; sid:2001715; rev:7;)
alert tcp $HOME_NET any -> !$SQL_SERVERS 3306        (msg:"E5[rb] ET WORM Potential MySQL bot scanning for SQL server"; flags: S,12; reference:url,isc.sans.org/diary.php?date=2005-01-27; classtype: trojan-activity; sid:2001689; rev:6;)


alert tcp $HOME_NET any -> $EXTERNAL_NET 3127        (msg:"E5[rb] ET SCAN Behavioral Unusual Port 3127 traffic, Potential Scan or Backdoor"; flags: S,12; threshold: type both, track by_src, count 10 , seconds 60; classtype: misc-activity; sid:2002973; rev:3;)

alert tcp $HOME_NET any -> $EXTERNAL_NET [139,445]  (msg:"E5[rb] ET SCAN Behavioral Unusual Port NETBIOS traffic, Potential Scan or Infection"; flags: S,12; threshold: type both, track by_src,  count 70 , seconds 60; classtype: misc-activity; sid:2001569; rev:12;)
alert tcp $HOME_NET any -> any 137  (msg:"E5[rb] ET SCAN Behavioral Unusual Port 137 traffic, Potential Scan or Infection"; flags: S,12; threshold: type both, track by_src,  count 70 , seconds 60; classtype: misc-activity; sid:2001580; rev:12;)

alert tcp $HOME_NET any -> any 1434 (msg:"E5[rb] ET SCAN Behavioral Unusual Port 1434 traffic, Potential Scan or Infection"; flags: S,12; threshold: type both, track by_src, count 40 , seconds 60; classtype: misc-activity; sid:2001582; rev:12;)
alert tcp $HOME_NET any -> any 1433 (msg:"E5[rb] ET SCAN Behavioral Unusual Port 1433 traffic, Potential Scan or Infection"; flags: S,12; threshold: type both, track by_src, count 40 , seconds 60; classtype: misc-activity; sid:2001583; rev:13;)


###########################################################################################################
##  BAD OUTBOUND EMAILS
###########################################################################################################
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET ATTACK RESPONSE Possible /etc/passwd via SMTP (BSD style)"; flow:established,from_server; content:"root\:*\:0\:0\:"; nocase; content:"\:/root\:/bin"; nocase; classtype:misc-activity; sid:2003150; rev:2;)
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET ATTACK RESPONSE Possible /etc/passwd via SMTP (linux style)"; flow:established,from_server; content:"root\:x\:0\:0\:root\:/root\:/"; nocase; classtype:misc-activity; sid:2003149; rev:2;)
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET EXPLOIT Outgoing Electronic Mail for UNIX Expires Header Buffer Overflow Exploit"; content:"Expires\:"; content:"|40 60 6e 63|"; distance:52; within:300; content:"|2d 70|";  distance:2; within:20; reference:url,www.frsirt.com/exploits/20050822.elmexploit.c.php; reference:url,www.instinct.org/elm/; classtype:misc-attack; sid:2002316; rev:4;)
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET EXPLOIT Incoming Electronic Mail for UNIX Expires Header Buffer Overflow Exploit"; content:"Expires\:"; content:"|40 60 6e 63|"; distance:52; within:300; content:"|2d 70|"; distance:2; within:20; reference:url,www.frsirt.com/exploits/20050822.elmexploit.c.php; reference:url,www.instinct.org/elm/; classtype:misc-attack; sid:2002315; rev:3;)
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET EXPLOIT MS05-021 Exchange Link State - Possible Attack (1)"; flow: to_server,established; content:"X-LINK2STATE"; nocase; reference:cve,CAN-2005-0560; reference:url,isc.sans.org/diary.php?date=2005-04-12; reference:url,www.microsoft.com/technet/security/bulletin/MS05-021.mspx; classtype: misc-activity; sid:2001848; rev:6;)
alert tcp !$SMTP_SERVERS any -> $EXTERNAL_NET 25  (msg:"E5[rb] ET POLICY Outbound Multiple Non-SMTP Server Emails"; flow:established; content:"mail from\:"; nocase; threshold: type threshold, track by_src,count 10, seconds 120; classtype: misc-activity; sid:2000328; rev:10;)
