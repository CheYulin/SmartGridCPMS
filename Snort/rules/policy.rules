# Copyright 2001-2005 Sourcefire, Inc. All Rights Reserved
#
# This file may contain proprietary rules that were created, tested and
# certified by Sourcefire, Inc. (the "VRT Certified Rules") as well as
# rules that were created by Sourcefire and other third parties and
# distributed under the GNU General Public License (the "GPL Rules").  The
# VRT Certified Rules contained in this file are the property of
# Sourcefire, Inc. Copyright 2005 Sourcefire, Inc. All Rights Reserved.
# The GPL Rules created by Sourcefire, Inc. are the property of
# Sourcefire, Inc. Copyright 2002-2005 Sourcefire, Inc. All Rights
# Reserved.  All other GPL Rules are owned and copyrighted by their
# respective owners (please see www.snort.org/contributors for a list of
# owners and their respective copyrights).  In order to determine what
# rules are VRT Certified Rules or GPL Rules, please refer to the VRT
# Certified Rules License Agreement.
#
#
# $Id: policy.rules,v 1.96 2009/10/06 17:02:13 vrtbuild Exp $
#-------------
# POLICY RULES
#-------------
#

# alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP anonymous login attempt"; flow:to_server,established; content:"USER"; nocase; pcre:"/^USER\s+(anonymous|ftp)[^\w]*[\r\n]/smi"; classtype:misc-activity; sid:553; rev:9;)

alert tcp $HOME_NET 23 -> $EXTERNAL_NET any (msg:"POLICY WinGate telnet server response"; flow:from_server,established; content:"WinGate>"; reference:arachnids,366; reference:cve,1999-0657; classtype:misc-activity; sid:555; rev:8;)


# we have started to see multiple versions of this beyond 003.003, so we have
# expanded this signature to take that into account.
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"POLICY VNC server response"; flow:established; content:"RFB 0"; depth:5; content:".0"; depth:2; offset:7; classtype:misc-activity; sid:560; rev:6;)

alert udp $EXTERNAL_NET any -> $HOME_NET 5632 (msg:"POLICY PCAnywhere server response"; content:"ST"; depth:2; reference:arachnids,239; classtype:misc-activity; sid:566; rev:6;)
alert tcp $SMTP_SERVERS 25 -> $EXTERNAL_NET any (msg:"POLICY SMTP relaying denied"; flow:established,from_server; content:"550 5.7.1"; depth:70; reference:arachnids,249; reference:url,mail-abuse.org/tsi/ar-fix.html; classtype:misc-activity; sid:567; rev:11;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 9100 (msg:"POLICY HP JetDirect LCD modification attempt"; flow:to_server,established; content:"@PJL RDYMSG DISPLAY ="; reference:arachnids,302; reference:bugtraq,2245; classtype:misc-activity; sid:568; rev:7;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 9000:9002 (msg:"POLICY HP JetDirect LCD modification attempt"; flow:to_server,established; content:"@PJL RDYMSG DISPLAY ="; reference:arachnids,302; reference:bugtraq,2245; classtype:misc-activity; sid:510; rev:8;)

# NOTES: This signature would be better off using uricontent, and having the
# http decoder looking at 5800 and 5802, but that is on by default
alert tcp $EXTERNAL_NET any -> $HOME_NET 5800:5802 (msg:"POLICY vncviewer Java applet download attempt"; flow:to_server,established; content:"/vncviewer.jar"; reference:nessus,10758; classtype:misc-activity; sid:1846; rev:4;)

alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP file_id.diz access possible warez site"; flow:to_server,established; content:"RETR"; nocase; content:"file_id.diz"; distance:1; nocase; classtype:suspicious-filename-detect; sid:1445; rev:5;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'STOR 1MB' possible warez site"; flow:to_server,established; content:"STOR"; nocase; content:"1MB"; distance:1; nocase; classtype:misc-activity; sid:543; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'RETR 1MB' possible warez site"; flow:to_server,established; content:"RETR"; nocase; content:"1MB"; distance:1; nocase; classtype:misc-activity; sid:544; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'CWD  ' possible warez site"; flow:to_server,established; content:"CWD  "; depth:5; nocase; classtype:misc-activity; sid:546; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'MKD  ' possible warez site"; flow:to_Server,established; content:"MKD  "; depth:5; nocase; classtype:misc-activity; sid:547; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'MKD .' possible warez site"; flow:to_server,established; content:"MKD ."; depth:5; nocase; classtype:misc-activity; sid:548; rev:6;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'CWD / ' possible warez site"; flow:to_server,established; content:"CWD"; nocase; content:"/ "; distance:1; classtype:misc-activity; sid:545; rev:5;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 21 (msg:"POLICY FTP 'MKD / ' possible warez site"; flow:to_server,established; content:"MKD"; nocase; content:"/ "; distance:1; classtype:misc-activity; sid:554; rev:6;)

alert tcp $EXTERNAL_NET any -> $HOME_NET 1723 (msg:"POLICY PPTP Start Control Request attempt"; flow:to_server,established,no_stream; content:"|00 01|"; depth:2; offset:2; content:"|00 01|"; depth:2; offset:8; classtype:attempted-admin; sid:2044; rev:5;)
alert udp $EXTERNAL_NET any -> $HOME_NET 49 (msg:"POLICY xtacacs login attempt"; flow:to_server; content:"|80 01|"; depth:2; content:"|00|"; distance:4; classtype:misc-activity; sid:2040; rev:4;)
alert udp $HOME_NET 49 -> $EXTERNAL_NET any (msg:"POLICY xtacacs accepted login response"; flow:to_client; content:"|80 02|"; depth:2; content:"|01|"; distance:4; classtype:misc-activity; sid:2042; rev:4;)
alert udp $EXTERNAL_NET any -> $HOME_NET 500 (msg:"POLICY IPSec PGPNet connection attempt"; flow:to_server; content:"|00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 10 02 00 00 00 00 00 00 00 00 88 0D 00 00 5C 00 00 00 01 00 00 00 01 00 00 00|P|01 01 00 02 03 00 00 24 01 01 00 00 80 01 00 06 80 02 00 02 80 03 00 03 80 04 00 05 80 0B 00 01 00 0C 00 04 00 01|Q|80 00 00 00 24 02 01 00 00 80 01 00 05 80 02 00 01 80 03 00 03 80 04 00 02 80 0B 00 01 00 0C 00 04 00 01|Q|80 00 00 00 10|"; classtype:protocol-command-decode; sid:1771; rev:7;)
alert udp any any -> 255.255.255.255 23945 (msg:"POLICY Data Rescue IDA Pro startup license check attempt"; flow:to_server; content:"IDA|00 01 00 00 00|"; depth:8; dsize:40; classtype:policy-violation; sid:3628; rev:4;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"POLICY AOL Instant Messenger Message Send"; flow:to_server,established; content:"*|02|"; depth:2; content:"|00 04 00 06|"; within:8; distance:4; byte_jump:1,16,relative; content:"|00 02|"; within:2; classtype:policy-violation; sid:3825; rev:2;)
alert tcp $EXTERNAL_NET 5190 -> $HOME_NET any (msg:"POLICY AOL Instant Messenger Message Receive"; flow:from_server,established; content:"*|02|"; depth:2; content:"|00 04 00 07|"; within:8; distance:4; byte_jump:1,16,relative; byte_jump:2,6,relative; byte_jump:2,2,relative; byte_jump:2,2,relative; byte_jump:2,2,relative; content:"|00 02|"; within:2; classtype:policy-violation; sid:3826; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 3389 (msg:"POLICY RDP attempted administrator connection request"; flow:to_server,established; content:"|E0|"; depth:1; offset:5; content:"mstshash"; distance:0; nocase; content:"Administr"; distance:0; nocase; pcre:"/mstshash\s*\x3d\s*Administr/smi"; reference:bugtraq,14259; reference:cve,2005-1218; reference:url,www.microsoft.com/technet/security/bulletin/MS05-041.mspx; classtype:misc-activity; sid:4060; rev:4;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Namazu outbound namazu.cgi access"; flow:to_server,established; uricontent:"/namazu.cgi?query="; uricontent:"&submit=Search"; reference:url,www.namazu.org/doc/manual.html; classtype:web-application-activity; sid:5707; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"POLICY Namazu incoming namazu.cgi access"; flow:to_server,established; uricontent:"/namazu.cgi?query="; uricontent:"&submit=Search"; reference:url,www.namazu.org/doc/manual.html; classtype:web-application-activity; sid:5706; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"POLICY HTML File upload attempt"; flow:to_server,established; content:"Content-Disposition"; nocase; content:"filename"; nocase; reference:url,www.faqs.org/rfcs/rfc1867.html; classtype:misc-activity; sid:5708; rev:2;)
# alert udp $HOME_NET any -> $EXTERNAL_NET 5060 (msg:"POLICY Gizmo register VOIP state"; content:"INVITE sip|3A|"; nocase; content:"User-Agent|3A|"; nocase; content:"Gizmo"; nocase; pcre:"/^User-Agent\x3A[^\n\r]+Gizmo/smi"; reference:url,www.gizmoproject.com; classtype:policy-violation; sid:6407; rev:1;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Gizmo VOIP client start-up version check"; flow:established,to_server; uricontent:"/dll/app?"; nocase; uricontent:"class=DLL"; nocase; uricontent:"ApplicationID"; nocase; uricontent:"Gizmo"; nocase; reference:url,www.gizmoproject.com; classtype:policy-violation; sid:6406; rev:1;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY webshots desktop traffic"; flow:to_server,established; content:"User-Agent|3A|"; nocase; content:"WebshotsNetClient"; distance:0; nocase; pcre:"/User-Agent\x3A[^\n\r]+WebshotsNetClient/smi"; threshold:type limit,track by_src,count 1,seconds 60; reference:url,www.webshots.com; classtype:misc-activity; sid:6408; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 8200 (msg:"POLICY GoToMyPC startup"; flow:to_server,established; content:"ercbroker.servlets.PingServlet"; nocase; reference:url,www.gotomypc.com/howItWorks.tmpl; classtype:policy-violation; sid:7032; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 8200 (msg:"POLICY GoToMyPC local service running"; flow:to_server,established; content:"jedi request"; nocase; threshold:type limit, track by_src, count 1, seconds 60; reference:url,www.gotomypc.com/howItWorks.tmpl; classtype:policy-violation; sid:7033; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 706 (msg:"POLICY silc client outbound connection attempt"; flow:to_server,established; content:"SILC"; pcre:"/SILC\x2d\d\x2e\d/smi"; reference:url,silcnet.org/docs/draft-riikonen-silc-spec-08.txt; classtype:policy-violation; sid:7031; rev:1;)
alert tcp $EXTERNAL_NET 706 -> $HOME_NET any (msg:"POLICY silc server response attempt"; flow:to_client,established; content:"SILC"; pcre:"/SILC\x2d\d\x2e\d/smi"; content:"silc-server"; distance:0; reference:url,silcnet.org/docs/draft-riikonen-silc-spec-08.txt; classtype:policy-violation; sid:7030; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 8200 (msg:"POLICY GoToMyPC remote control attempt"; flow:to_server,established; content:"jedi"; nocase; content:"request=agent"; distance:0; nocase; threshold:type limit, track by_src, count 1, seconds 60; reference:url,www.gotomypc.com/howItWorks.tmpl; classtype:policy-violation; sid:7034; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Desktop initial install  - installer request"; flow:to_server,established; uricontent:"/installer?"; uricontent:"action=install"; uricontent:"version="; uricontent:"id="; uricontent:"brand=GGLD"; uricontent:"hl="; content:"User-Agent|3A|"; nocase; content:"Google"; distance:0; nocase; content:"Desktop"; distance:0; nocase; pcre:"/User-Agent\x3A[^\n\r]+Google[^\n\r]+Desktop/smi"; classtype:policy-violation; sid:7859; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Desktop search query"; flow:to_server,established; uricontent:"/complete/search?"; uricontent:"q="; uricontent:"output=desktop"; uricontent:"sourceid=gd"; content:"User-Agent|3A|"; nocase; content:"Google"; distance:0; nocase; content:"Desktop"; distance:0; nocase; pcre:"/User-Agent\x3A[^\n\r]+Google[^\n\r]+Desktop/smi"; classtype:policy-violation; sid:7860; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Desktop initial install - firstuse request"; flow:to_server,established; uricontent:"/firstuse?"; uricontent:"version="; uricontent:"id="; uricontent:"brand=GGLD"; uricontent:"hl="; content:"User-Agent|3A|"; nocase; content:"Google"; distance:0; nocase; content:"Desktop"; distance:0; nocase; pcre:"/User-Agent\x3A[^\n\r]+Google[^\n\r]+Desktop/smi"; classtype:policy-violation; sid:7858; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Desktop activity"; flow:to_server,established; content:"User-Agent|3A|"; nocase; content:"Google"; distance:0; nocase; content:"Desktop"; distance:0; nocase; pcre:"/User-Agent\x3A[^\n\r]+Google[^\n\r]+Desktop/smi"; threshold:type limit, track by_src, count 1, seconds 300; classtype:policy-violation; sid:7861; rev:1;)
# alert ip $EXTERNAL_NET any -> $HOME_NET any (msg:"POLICY IPv6 encapsulated in IPv4 activity"; ip_proto:41; classtype:policy-violation; sid:8446; rev:1;)
alert tcp $EXTERNAL_NET 25999 -> $HOME_NET any (msg:"POLICY Xfire login successful"; flow:established,to_client; content:"|82|"; depth:1; offset:2; content:"userid"; depth:6; offset:6; reference:url,www.fryx.ch/xfire/protocol.html; classtype:policy-violation; sid:8484; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 25999 (msg:"POLICY Xfire session initiated"; flow:established,to_server; content:"UA01"; depth:4; reference:url,www.fryx.ch/xfire/protocol.html; classtype:policy-violation; sid:8482; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 25999 (msg:"POLICY Xfire login attempted"; flow:established,to_server; content:"|01|"; depth:1; offset:2; content:"name"; depth:4; offset:6; reference:url,www.fryx.ch/xfire/protocol.html; classtype:policy-violation; sid:8483; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 9030:9031 (msg:"POLICY TOR Traffic anonymizer server request"; flow:established,to_server; content:"GET /tor/server"; classtype:policy-violation; sid:9324; rev:1;)
# alert tcp $EXTERNAL_NET any -> $HOME_NET 13782 (msg:"POLICY VERITAS NetBackup system execution function call access attempt"; flow:established,to_server; content:"|00 18 00 1B 00 02|"; depth:18; reference:bugtraq,21565; reference:cve,2006-4902; reference:cve,2006-6822; classtype:misc-activity; sid:10130; rev:3;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY download of executable content"; flow:to_client,established; content:"application/octet-stream"; nocase; pcre:"/^Content-Type\x3a[\x20\x09]+application\/octet-stream/smi"; pcre:"/(\r?\n){2}MZ/sm"; reference:url,www.microsoft.com/smallbusiness/resources/technology/security/practice_safe_computing_and_thwart_online_thugs.mspx; classtype:policy-violation; sid:11192; rev:1;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Visio file download"; flow:established,to_client; content:"Visio |28|TM|29| Drawing|0D 0A|"; nocase; reference:url,office.microsoft.com/en-us/visio/default.aspx; classtype:policy-violation; sid:11835; rev:1;)
alert udp $HOME_NET any -> $EXTERNAL_NET 3544 (msg:"POLICY Outbound Teredo traffic detected"; flow:to_server; content:" |01|"; depth:2; offset:8; byte_test:1,&,96,0; reference:cve,2007-3038; reference:url,www.microsoft.com/technet/security/Bulletin/MS07-038.mspx; classtype:policy-violation; sid:12065; rev:2;)
alert udp $EXTERNAL_NET 3544 -> $HOME_NET any (msg:"POLICY Inbound Teredo traffic detected"; flow:to_server; content:"?|FE 83 1F|"; depth:4; offset:8; byte_test:1,&,96,0; reference:cve,2007-3038; reference:url,www.microsoft.com/technet/security/Bulletin/MS07-038.mspx; classtype:policy-violation; sid:12068; rev:2;)
alert udp $EXTERNAL_NET 3544 -> $HOME_NET any (msg:"POLICY Inbound Teredo traffic detected"; flow:to_server; content:" |01|"; depth:2; offset:8; byte_test:1,&,96,0; reference:cve,2007-3038; reference:url,www.microsoft.com/technet/security/Bulletin/MS07-038.mspx; classtype:policy-violation; sid:12066; rev:3;)
alert udp $HOME_NET any -> $EXTERNAL_NET 3544 (msg:"POLICY Outbound Teredo traffic detected"; flow:to_server; content:"?|FE 83 1F|"; depth:4; offset:8; byte_test:1,&,96,0; reference:cve,2007-3038; reference:url,www.microsoft.com/technet/security/Bulletin/MS07-038.mspx; classtype:policy-violation; sid:12067; rev:2;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Adobe FLV file transfer"; flow:established,to_client; content:"FLV|01|"; content:"|00 00 00 09|"; within:4; distance:1; flowbits:set,flv.xfer; classtype:misc-activity; sid:12182; rev:3;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 16800:17000 (msg:"POLICY P2PTv TVAnts TCP tracker connect traffic detected"; flow:to_server,established; flowbits:isnotset,tvant.session; content:"|04 00 07 00|"; depth:4; content:"TVANTS SHARE"; depth:12; offset:8; flowbits:set,tvant.session; classtype:policy-violation; sid:12210; rev:1;)
alert tcp $EXTERNAL_NET 16800:17000 -> $HOME_NET any (msg:"POLICY P2PTv TVAnts TCP connection traffic detected"; flow:to_client,established; flowbits:isnotset,tvant.session; content:"|04 00|"; depth:2; pcre:"/[\x01|\x02|\x03|\x04|\x05|\x06|\x07]\x00.{4}\x43\x00/R"; flowbits:set,tvant.session; classtype:policy-violation; sid:12211; rev:1;)
alert udp $HOME_NET 16800:17000 -> $EXTERNAL_NET any (msg:"POLICY P2PTv TVAnt udp traffic detected"; flowbits:isnotset,tvant.session; content:"|04 00|"; depth:2; pcre:"/[\x05|\x06|\x07]\x00.{6}[SS|DS]/R"; flowbits:set,tvant.session; classtype:policy-violation; sid:12209; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 80 (msg:"POLICY Microsoft Media Player compressed skin download"; flow:established, to_server; content:"GET"; nocase; pcre:"/GET\s+[^\x20]*\x2Ewm[zd]/smi"; reference:url,www.microsoft.com/technet/security/Bulletin/MS07-047.mspx; classtype:policy-violation; sid:12278; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Chat web client connection"; flow:established,to_server; uricontent:"/talkgadget/popout"; nocase; classtype:policy-violation; sid:12303; rev:3;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Yahoo Messenger web client connection"; flow:established,to_server; uricontent:"/BootStrapper.swf"; nocase; classtype:policy-violation; sid:12305; rev:4;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY AOL Instant Messenger web client connection"; flow:established,to_server; uricontent:"HostCheck.aspx"; nocase; uricontent:"aimexpress.aol.com"; pcre:"/Cookie\x3A.*s_sq=aolsnssignin/si"; classtype:policy-violation; sid:12304; rev:2;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY  Microsoft Messenger web client connection"; flow:established,to_server; uricontent:"mainui.aspx"; nocase; content:"webmessenger"; nocase; classtype:policy-violation; sid:12306; rev:3;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Crystal reports download request"; flow:to_server, established; uricontent:".rpt"; nocase; flowbits:set, rpt.download; flowbits:noalert; classtype:policy-violation; sid:12455; rev:2;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:"POLICY Ruckus encrypted authentication connection"; flow:to_server,established; content:"|00 00|"; content:"www.ruckus.com"; within:14; distance:7; classtype:policy-violation; sid:12427; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Google Webmail client chat applet"; flow:established,to_server; content:"POST"; nocase; content:"/mail/channel/bind"; nocase; classtype:policy-violation; sid:12391; rev:2;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Ruckus P2P client"; flow:to_server, established; content:"User-Agent|3A| Ruckus/"; nocase; classtype:policy-violation; sid:12425; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 5050 (msg:"POLICY Yahoo Webmail client chat applet"; flow:established,to_server; content:"<Ymsg Command="; nocase; classtype:policy-violation; sid:12390; rev:2;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Crystal reports download"; flow:to_client, established; flowbits:isset, rpt.download; content:"|D0 CF 11 E0 A1 B1 1A E1 00|"; reference:bugtraq,21261; reference:cve,2006-6133; reference:url,www.microsoft.com/technet/security/bulletin/ms07-052.mspx; classtype:policy-violation; sid:12456; rev:1;)
alert udp $HOME_NET 5353 -> 224.0.0.251 5353 (msg:"POLICY Ruckus P2P broadcast domain probe"; flow:to_server; content:"ruckus|04|_tcp|05|local"; classtype:policy-violation; sid:12426; rev:2;)
# alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Word for Mac 5 file download"; flow:to_client,established; content:"|FE|7|00 23|"; pcre:"/^\xfe\x37\x00\x23/m"; reference:bugtraq,25906; reference:cve,2007-3899; reference:url,www.microsoft.com/technet/security/bulletin/MS07-060.mspx; classtype:policy-violation; sid:12641; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY AIM Express Usage"; flow:to_server,established; content:"Host|3A| aimexpress.aol.com"; nocase; reference:url,www.aim.com/aimexpress.adp; classtype:policy-violation; sid:12686; rev:1;)
# alert tcp $HOME_NET 3306 -> $EXTERNAL_NET any (msg:"POLICY failed mysql login attempt"; flow:established,from_server; content:"|15 04|"; depth:2; offset:5; metadata:policy security-ips alert, service mysql; reference:url,dev.mysql.com/doc/refman/5.1/en/error-messages-server.html; classtype:misc-activity; sid:13357; rev:1;)
# alert tcp $HOME_NET 21 -> $EXTERNAL_NET any (msg:"POLICY failed FTP login attempt"; flow:established,from_server; content:"530 "; depth:4; metadata:policy security-ips alert, service ftp; reference:url,www.ietf.org/rfc/rfc0959.txt; classtype:misc-activity; sid:13360; rev:1;)
# alert tcp $HOME_NET 143 -> $EXTERNAL_NET any (msg:"POLICY failed IMAP login attempt - invalid username/password"; flow:established,from_server; content:"NO LOGIN"; nocase; pcre:"/^\s*\w+\s+NO LOGIN/smi"; metadata:policy security-ips alert, service imap; reference:url,www.ietf.org/rfc/rfc3501.txt; classtype:misc-activity; sid:13359; rev:1;)
# alert tcp $HOME_NET 3306 -> $EXTERNAL_NET any (msg:"POLICY mysql login attempt from unauthorized location"; flow:established,from_server; content:"j|04|"; depth:2; offset:5; metadata:policy security-ips alert, service mysql; reference:url,dev.mysql.com/doc/refman/5.1/en/error-messages-server.html; classtype:misc-activity; sid:13358; rev:1;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Inbound potentially malicious file download attempt"; flow:to_server,established; content:"GET /"; nocase; pcre:"/^GET \x2F[^\r\n\x3F]+\.(?=[abcdehijlmnoprsvwx])(a(d[ep]|s[dfx])|c([ho]m|li|md|pp)|d(iz|ll|ot)|e(m[fl]|xe)|h(lp|sq|ta)|jse?|m(d[abew]|s[ip])|p(p[st]|if|[lm]|ot)|r(eg|tf)|s(cr|[hy]s|wf)|v(b[es]?|cf|xd)|w(m[dfsz]|p[dmsz]|s[cfh])|xl[tw]|bat|ini|lnk|nws|ocx)[\x27\x22\n\r\s]/smi"; classtype:suspicious-filename-detect; sid:13592; rev:2;)
# alert tcp $EXTERNAL_NET !22 -> $HOME_NET any (msg:"POLICY SSH server detected on non-standard port"; flow:established,from_server; content:"SSH-"; depth:4; nocase; pcre:"/^SSH-[12]\.\d+/smi"; reference:url,www.ietf.org/rfc/rfc4251.txt; classtype:protocol-command-decode; sid:13586; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg:"POLICY TOR proxy connection initiation second alternate port"; flow:to_server,established; content:"TOR"; content:"client <identity>"; classtype:policy-violation; sid:13698; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 9001:9030 (msg:"POLICY TOR proxy connection initiation"; flow:to_server,established; content:"TOR"; content:"client <identity>"; classtype:policy-violation; sid:13696; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET 80 (msg:"POLICY TOR proxy connection initiation alternate port"; flow:to_server,established; content:"TOR"; content:"client <identity>"; classtype:policy-violation; sid:13697; rev:1;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Habbo chat client successful login"; flow:to_client,established; content:"document.habboLoggedIn = true"; metadata:policy security-ips drop; reference:url,www.habbo.com; classtype:policy-violation; sid:13863; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Habbo chat client item information download"; flow:to_server,established; uricontent:"/gamedata/external?id=external_"; metadata:policy security-ips drop; reference:url,www.habbo.com; classtype:policy-violation; sid:13862; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY Microsoft Watson error reporting attempt"; flow:to_server, established; content:"User-Agent|3A| MSDW"; content:"watson.microsoft.com"; uricontent:"StageOne"; metadata:policy security-ips drop, service http; reference:url,oca.microsoft.com/en/dcp20.asp; classtype:policy-violation; sid:13864; rev:1;)
alert tcp $EXTERNAL_NET 38101 -> $HOME_NET any (msg:"POLICY Habbo chat client avatar control"; flow:to_client,established; content:"/flatctrl useradmin/"; metadata:policy security-ips drop; reference:url,www.habbo.com; classtype:policy-violation; sid:13861; rev:1;)
# alert tcp $HOME_NET [5900:5999] -> $EXTERNAL_NET any (msg:"POLICY RealVNC Server configured to allow NULL authentication"; flow:established, to_client; flowbits:isset, vnc.pv.setup; content:"|01|"; offset:1; flowbits:unset,vnc.pv.setup; reference:url,www.realvnc.com/docs/rfbproto.pdf; classtype:misc-activity; sid:13881; rev:1;)
# alert tcp $HOME_NET [5900:5999] -> $EXTERNAL_NET any (msg:"POLICY RealVNC Server configured not to require authentication"; flow:established, to_client; flowbits:isset, vnc.pv.setup; pcre:"/^(?!RFB).[^\x01]+/"; flowbits:unset,vnc.pv.setup; flowbits:noalert; reference:url,www.realvnc.com/docs/rfbproto.pdf; classtype:misc-activity; sid:13882; rev:1;)
# alert tcp $HOME_NET any -> any 3689 (msg:"POLICY iTunes client login attempt"; flow:established, to_server; flowbits:isset,itunes.serverinfo.request; content:"/login"; depth:6; offset:4; nocase; reference:url,www.apple.com/itunes/; classtype:misc-activity; sid:13899; rev:3;)
# alert tcp $HOME_NET any -> any 3689 (msg:"POLICY iTunes client request for server info"; flow:established, to_server; content:"/server-info"; flowbits:set,itunes.serverinfo.request; flowbits:noalert; reference:url,www.apple.com/itunes/; classtype:misc-activity; sid:13898; rev:3;)
# alert udp $HOME_NET 5353 -> 224.0.0.251 5353 (msg:"POLICY iTunes server multicast DNS response"; content:"Library|05|_daap|04|_tcp|05|local"; content:"|00|!"; depth:2; offset:1; content:"|0E|i"; depth:2; offset:12; nocase; reference:url,www.apple.com/itunes/; reference:url,www.multicastdns.org; classtype:misc-activity; sid:13900; rev:3;)
# alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY kontiki runtime detection"; flow:to_server, established; content:"User-Agent|3A|"; nocase; content:"Kontiki"; distance:0; nocase; content:"Client"; distance:0; nocase; pcre:"/^User-Agent\x3A[^\r\n]*Kontiki\s+Client/smi"; threshold:type limit, track by_src, count 1, seconds 300; metadata:policy security-ips alert; reference:url,www.extremetech.com/article2/0,3973,365073,00.asp; classtype:misc-activity; sid:5797; rev:4;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY XBOX avatar retrieval request"; flow:to_server,established; uricontent:"/avatar/"; content:"User-Agent|3A| Xbox Live Client/"; content:"Host|3A|avatar.xboxlive.com|0D 0A|"; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:policy-violation; sid:15172; rev:2;)
alert udp $HOME_NET any -> $EXTERNAL_NET 53 (msg:"POLICY Suspicious .ru dns query"; content:"|01 00 00 01 00 00 00 00 00 00|"; depth:10; offset:2; content:"|02|ru"; distance:0; pcre:"/[\x05-\x20][bcdfghjklmnpqrstvwxyz]{5,32}\x02ru/i"; metadata:policy security-ips drop, service dns; classtype:trojan-activity; sid:15168; rev:4;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY XBOX Netflix client active"; flow:to_server,established; content:"User-Agent|3A| NETFLIX360|0D 0A|"; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:policy-violation; sid:15170; rev:2;)
alert tcp $EXTERNAL_NET 443 -> $HOME_NET any (msg:"POLICY Nintendo Wii SSL Server Hello"; flow:to_client,established; content:"Nintendo of America Inc"; content:"noa.nintendo.com"; content:"|16|"; depth:1; content:"|02|"; depth:6; offset:5; metadata:policy balanced-ips drop, policy security-ips drop, service ssl; classtype:policy-violation; sid:15185; rev:1;)
alert udp $HOME_NET any -> $EXTERNAL_NET 53 (msg:"POLICY Suspicious .cn dns query"; content:"|01 00 00 01 00 00 00 00 00 00|"; depth:10; offset:2; content:"|02|cn"; distance:0; pcre:"/[\x05-\x20][bcdfghjklmnpqrstvwxyz]{5,32}\x02cn/i"; metadata:policy security-ips drop, service dns; classtype:trojan-activity; sid:15167; rev:3;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"POLICY XBOX Marketplace http request"; flow:to_server,established; uricontent:"/global"; uricontent:"/marketplace"; content:"User-Agent|3A| Xbox Live Client/"; metadata:policy balanced-ips drop, policy security-ips drop, service http; classtype:policy-violation; sid:15171; rev:2;)
alert udp $HOME_NET any -> $EXTERNAL_NET 88 (msg:"POLICY XBOX Live Kerberos Authenthication Request"; flow:to_server; content:"Xbox Version="; content:"PASSPORT.NET"; distance:0; metadata:policy balanced-ips drop, policy security-ips drop, service kerberos; classtype:policy-violation; sid:15169; rev:2;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 25 (msg:"POLICY pdf file sent via email"; flow:to_server,established; content:"JVBERi0x"; flowbits:set,email.pdf; flowbits:noalert; metadata:service smtp; classtype:policy-violation; sid:15361; rev:1;)
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 (msg:"POLICY X-LINK2STATE CHUNK command attempt"; flow:to_server,established; content:"X-LINK2STATE"; nocase; pcre:"/^X-LINK2STATE\s+CHUNK/smi"; reference:bugtraq,13118; reference:cve,2005-0560; reference:nessus,18024; reference:url,www.microsoft.com/technet/security/bulletin/MS05-021.mspx; classtype:protocol-command-decode; sid:3627; rev:5;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"POLICY Attempted download of a PDF with embedded Flash"; flow:to_client, established; flowbits:isset,pdf_file.request; content:"stream|0D 0A|FWS"; metadata:policy balanced-ips alert, policy connectivity-ips alert, policy security-ips alert, service http; reference:bugtraq,35759; reference:url,blogs.adobe.com/psirt/2009/07/potential_adobe_reader_and_fla.html; classtype:policy-violation; sid:15727; rev:1;)
